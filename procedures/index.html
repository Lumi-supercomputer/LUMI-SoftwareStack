
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Technical documentation for the LUMI software stack">
      
      
      
        <link rel="canonical" href="https://Lumi-supercomputer.github.io/LUMI-SoftwareStack/procedures/">
      
      
        <link rel="prev" href="../CrayPE_integration/">
      
      
        <link rel="next" href="../directory_structure/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.1">
    
    
      
        <title>Some procedures - LUMI Software Stack technical documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.402914a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#some-procedures" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LUMI Software Stack technical documentation" class="md-header__button md-logo" aria-label="LUMI Software Stack technical documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LUMI Software Stack technical documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Some procedures
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent=""  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Lumi-supercomputer/LUMI-SoftwareStack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LUMI Software Stack technical documentation" class="md-nav__button md-logo" aria-label="LUMI Software Stack technical documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LUMI Software Stack technical documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Lumi-supercomputer/LUMI-SoftwareStack" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../whats_new/" class="md-nav__link">
        What's new or different?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../start_on_LUMI_pilot/" class="md-nav__link">
        Installation instructions for the pilot phase
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../module_setup/" class="md-nav__link">
        Setup of the LUMI module system
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../easybuild_setup/" class="md-nav__link">
        EasyBuild setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../CrayPE_integration/" class="md-nav__link">
        Cray PE integration
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Some procedures
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Some procedures
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-a-new-version-of-the-cray-pe-on-the-system" class="md-nav__link">
    Installing a new version of the Cray PE on the system
  </a>
  
    <nav class="md-nav" aria-label="Installing a new version of the Cray PE on the system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1-making-available-in-crayenv" class="md-nav__link">
    Part 1: Making available in CrayEnv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-adding-support-as-a-lumiyymmdev-software-stack" class="md-nav__link">
    Part 2: Adding support as a LUMI/yy.mm(.dev) software stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-master-installation-of-the-software-stack" class="md-nav__link">
    Making a master installation of the software stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bumping-the-toolchain-to-a-newer-version-without-changing-the-other-dependencies" class="md-nav__link">
    Bumping the toolchain to a newer version without changing the other dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bumping-the-toolchain-to-a-newer-version-and-changing-the-other-dependencies" class="md-nav__link">
    Bumping the toolchain to a newer version and changing the other dependencies
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../directory_structure/" class="md-nav__link">
        Installation directory structure
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../files_used/" class="md-nav__link">
        Overview of files
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../SitePackage/" class="md-nav__link">
        The contents of the SitePackage.lua file
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
          Toolchain documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Toolchain documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/toolchain_common/" class="md-nav__link">
        EasyBuild toolchains common options
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/toolchain_cpe_common/" class="md-nav__link">
        Common information to all cpe* toolchains
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/cpeCray/" class="md-nav__link">
        cpeCray toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/cpeGNU/" class="md-nav__link">
        cpeGNU toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/cpeAOCC/" class="md-nav__link">
        cpeAOCC toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Toolchains/cpeAMD/" class="md-nav__link">
        cpeAMD toolchain
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../configurations/" class="md-nav__link">
        Configurations on LUMI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
          Documentation on our EasyBlocks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Documentation on our EasyBlocks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../CrayPEToolchain/" class="md-nav__link">
        The CrayPEToolchain EasyBlock
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
          Archive
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          Archive
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../failed_experiments/" class="md-nav__link">
        Failed experiments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-a-new-version-of-the-cray-pe-on-the-system" class="md-nav__link">
    Installing a new version of the Cray PE on the system
  </a>
  
    <nav class="md-nav" aria-label="Installing a new version of the Cray PE on the system">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#part-1-making-available-in-crayenv" class="md-nav__link">
    Part 1: Making available in CrayEnv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#part-2-adding-support-as-a-lumiyymmdev-software-stack" class="md-nav__link">
    Part 2: Adding support as a LUMI/yy.mm(.dev) software stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-a-master-installation-of-the-software-stack" class="md-nav__link">
    Making a master installation of the software stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bumping-the-toolchain-to-a-newer-version-without-changing-the-other-dependencies" class="md-nav__link">
    Bumping the toolchain to a newer version without changing the other dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bumping-the-toolchain-to-a-newer-version-and-changing-the-other-dependencies" class="md-nav__link">
    Bumping the toolchain to a newer version and changing the other dependencies
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="some-procedures">Some procedures<a class="headerlink" href="#some-procedures" title="Permanent link">&para;</a></h1>
<h2 id="installing-a-new-version-of-the-cray-pe-on-the-system">Installing a new version of the Cray PE on the system<a class="headerlink" href="#installing-a-new-version-of-the-cray-pe-on-the-system" title="Permanent link">&para;</a></h2>
<h3 id="part-1-making-available-in-crayenv">Part 1: Making available in CrayEnv<a class="headerlink" href="#part-1-making-available-in-crayenv" title="Permanent link">&para;</a></h3>
<p>These instructions are enough to make the new CPE available in the <code>CrayEnv</code> stack
but do not yet include instructions for EasyBuild</p>
<ul>
<li>
<p>Install the CPE components using the instructions of HPE</p>
</li>
<li>
<p>Create the components file in the <code>CrayPE</code> subdirectory of the repository.
    This is currently a simple .csv-file but may be replaced by a different one if
    HPE would provide that information in machine-readable format in a future version
    of the CPE.</p>
<p>Much of that information can be extracted from the HPE-Cray provided file
<code>/opt/cray/pe/cpe/yy.mm/modulerc.lua</code>, though we do currently keep some additional
packages in that file that don't have their defaults set in that file. One of them
which is actually used in the LUMIpartition module file is the version of the
craype-targets packages (essentially the CPE targeting modules).</p>
</li>
<li>
<p><strong>This step is only needed if you don't do part 2 as the installation script used
    in part 2 of this procedure will also do this.</strong></p>
<p>Add a <code>cpe/yy.mm.lua</code> link for the just installed programming environment to
the <code>modules/CrayOverwrite/core</code> subdirectory of the modules tree (NOT in the
<code>modules</code> directory of the repository). This file does need the .csv file
generated in the previous step to function properly.</p>
<p>Note that this directory also contains a link named <code>.modulerc</code> to the
<code>.version</code>file of `/opt/cray/pe/lmod/modulefiles/core/cpe''. It is essential
that the default version of the <code>cpe</code> module is the same in the original module
directory and in <code>CrayOVerwrite</code> as otherwise the original one may get loaded
in some circumstances. By using the symbolic link and the new name with higher
priority we assure that the modules from <code>CrayOVerwrite</code> are used. One still
needs to ensure that the overwrite modules also are more to the front of the
<code>MODULEPATH</code> or things still go wrong.</p>
</li>
<li>
<p><strong>This step is only needed if you don't do part 2 as the installation script used
    in part 2 of this procedure will also do this.</strong></p>
<p>If <code>/opt/cray/pe/cpe/yy.mm/modulerc.lua</code> is missing on the system, an alternative
needs to be generated and stored in <code>modules/CrayOverwrite/data-cpe/yy.mm</code> as
it is used by the generic cpe module installed in the previous step.</p>
<p>This can be done by running <code>./make_CPE_modulerc yy.mm</code> in the <code>scripts</code> subdirectory
of <code>SystemRepo</code>.</p>
</li>
<li>
<p>Hide the new cpe module installed in the Cray PE subdirectory by adding a line to
    <code>LMOD/modulerc.lua</code> in the <code>LUMI-SoftwareStack</code> repository.</p>
</li>
<li>
<p>If there are new Cray targeting modules that are irrelevant for LUMI you may want to
    hide them in the respective code block in <code>LMOD/LUMIstack_modulerc.lua</code>
    in the <code>LUMI-SoftwareStack</code> repository.</p>
</li>
</ul>
<h3 id="part-2-adding-support-as-a-lumiyymmdev-software-stack">Part 2: Adding support as a LUMI/yy.mm(.dev) software stack<a class="headerlink" href="#part-2-adding-support-as-a-lumiyymmdev-software-stack" title="Permanent link">&para;</a></h3>
<p>From here on the setup is largely automated by the <code>prepare_LUMI_stack.sh</code> script
in the <code>scripts</code> subdirectory of the repository. A few things need to be in place
though before running this script:</p>
<ul>
<li>
<p>The component definition of the Cray PE software stack in the .csv file in the
    <code>CrayPE</code> subdirectory.</p>
</li>
<li>
<p>An EasyConfig file for the right version of EasyBuild in the
    <code>easybuild/easyconfigs/e/EasyBuild</code> subdirectory of the repository.</p>
<p>Note that it is always possible to run <code>prepare_LUMI_stack.sh</code>-script
with <code>EASYBUILD_IGNORE_CHECKSUMS=1</code> set if the checksums in the EasyConfig
file are not yet OK.</p>
</li>
<li>
<p>Add a software stack-specific configuration file
    <code>easybuild-production-LUMI-yy.mm.cfg</code> for EasyBuild if
    needed in the <code>easybuild/config</code> subdirectory of the repository.</p>
<p>We currently don't include the <code>.dev</code> extension, i.e., if there is a development
and an LTS software stack for the same version of the CPE, they share the EasyBuild
configuration file. This makes sense because the development stack is meant to
prepare for a production stack.</p>
</li>
</ul>
<p>Furthermore you may want to make sure that the proper versions of the following files
are available in the repository should you want to make changes compared to versions
installed before:</p>
<ul>
<li>
<p>The generic <code>EasyBuild-config</code> module should you want to make changes to, e.g.,
    the environment variables et by that module.</p>
</li>
<li>
<p>The generic <code>LUMIstack</code> and <code>LUMIpartition</code> module.</p>
</li>
<li>
<p>The generic cpe module <code>cpe-generic</code>.</p>
</li>
</ul>
<p>The software stack initialisation script will take the most recent one
(based on the yy.mm version number) that is not newer than the release
of the CPE for the software stack.</p>
<p>The <code>prepare_LUMI_stack.sh</code> script takes three arguments, and the order is important:</p>
<ol>
<li>
<p>The version of the software stack: the Cray PE version, with the extension <code>.dev</code>
    for a development stack (e.g., 21.05.dev or 21.06).</p>
</li>
<li>
<p>The version of EasyBuild to install in the software stack</p>
</li>
<li>
<p>A work directory for temporary files, used to install a bootstrapping copy
    of EasyBuild. Rather than trying to use an EasyBuild installation from an
    older software stack if present to bootstrap the new one, we simply chose
    to do a bootstrap every time the script is run as this is a procedure
    that simply always works, though it is more time consuming.</p>
<p>The advantage however is that one can just clone the production repository
anywhere, run an initialisation script to initialise the structure around
the repository, then initialise a software stack and start working.</p>
</li>
</ol>
<p>The script then does the following steps:</p>
<ul>
<li>
<p>Generate our own <code>cpe/yy.mm</code> module in <code>modules/CrayOverwrite/core</code> by creating
    a symbolic link to the right version of the generic modules in <code>SystemRepo</code>.</p>
</li>
<li>
<p>Check if the Cray PE comes with its own <code>modulerc.lua</code> file with the default components
    (if so, that file can be found in <code>/opt/cray/pe/cpe/yy.mm</code>). If not an alternative
    file is generated from the data in the compoments .csv file and stored in
    <code>modules/CrayOverwrite/data-cpe/yy.mm</code>.</p>
<p>The file is used by the generic <code>cpe/yy.mm</code> module in <code>modules/CrayOVerwrite/core</code>.</p>
</li>
<li>
<p>Create the software stack module files by symlinking to the generic implementations
    in <code>SystemRepo</code>.</p>
</li>
<li>
<p>Create the partition modules (second level in the hierarchy) by symlinking to the
    generic implementations in <code>SystemRepo</code>.</p>
</li>
<li>
<p>Create the <code>LUMIstack_yy.mm_modulerc.lua</code> file in <code>mgmt/LMOD/ModuleRC</code>.
    Currently this file only contain references to Cray PE modules and as such correspond
    to the <code>modulerc.lua</code> file in <code>/opt/cray/pe/cpe/yy.mm</code> but his may change in
    a future version. Whereas the aforementioned <code>modulerc.lua</code> files are meant to
    be activated by the <code>cpe.yy.mm</code> modules and hence to be used by any software
    stack that uses the Cray PE, the <code>LUMIstack_yy.mm_modulerc.lua</code> are really meant
    exclusively for the LUMI software stack.</p>
<p>This is done by running the <code>make_LUMIstack_modulerc.sh</code> script.</p>
</li>
<li>
<p>Creates the <code>CPE_modules_*.lua</code> file in <code>mgmt/LMOD/VisibilityHookData</code> for
    <code>module avail</code> visibility hook in <code>SitePackage.lua</code>. This is done by running
    the <code>make_CPE_VisibilityHookData.sh</code> script.</p>
</li>
<li>
<p>Creates the full directory structure for the software stack for the modules,
    the binary installations and the EasyBuild repo.</p>
</li>
<li>
<p>Creates the EasyBuild external modules definition file from the data in the
    corresponding <code>CPEpakcages_&lt;CPE version&gt;.csv</code> file (if the file does not yet
    exist). This file is stored in the repo as it may be useful for other people
    who check out the repository to know what is going on.</p>
</li>
<li>
<p>Creates the EasyBuild-production, EasyBuild-infrastructure and EasyBuild-user
    modules for each partition by softlinking to the matching generic file in
    the <code>SystemRepo</code>.</p>
</li>
<li>
<p>Downloads the selected version of EasyBuild to the EasyBuild sources directory
    if the files are not yet present.</p>
</li>
<li>
<p>Installs a bootstrapping version of EasyBuild in the work directory. As that
    version will only be used to install EasyBuild from our own EasyConfig file,
    there is no need to also install the EasyConfig files.</p>
</li>
<li>
<p>Loads the software stack module for the common partition and the EasyBuild-production
    module to install EasyBuild in the software stack.</p>
</li>
<li>
<p>Create EasyConfig files in the repository for the <code>cpeCray</code>, <code>cpeGNU</code> and <code>cpeAMD</code>
    toolchains (if those files do not yet exist) and use the just installed EasyBuild
    to install them in the <code>Infrastructure</code> module subdirectory for all 4 regular
    and the common partition.</p>
<p>The toolchain definition EasyConfig files are generated by the <code>make_CPE_EBfile.sh</code>
script.</p>
</li>
</ul>
<p>Things to do afterwards:</p>
<ul>
<li>If you want to change the default version of the LUMI software stack module,
    you can do this by editing <code>.modulerc.lua</code> in
    <code>modules/SoftwareStack/LUMI</code>.</li>
</ul>
<p>And now one should be ready to install other software...</p>
<ul>
<li>
<p>Ensure the software stack module is loaded and the partition module for the
    location where you want to install the software is loaded (so the hidden module
    partition/common to install software in the location common to all regular
    partitions)</p>
</li>
<li>
<p>Load EasyBuild-production for an install in the production directories or
    EasyBuild-user for an install in the user or project directories (and you'll
    need to set some environment variables beforehand to point to that location).</p>
</li>
</ul>
<h2 id="making-a-master-installation-of-the-software-stack">Making a master installation of the software stack<a class="headerlink" href="#making-a-master-installation-of-the-software-stack" title="Permanent link">&para;</a></h2>
<p>A master version is an installation of the full system that can run independently from
another installation. This is made easy so that it is possible to install a master
version under a personal account or on a test system for testing and development independent
from the central installation on the system.</p>
<ol>
<li>
<p>Create an empty directory which will be the root of the software installation.</p>
</li>
<li>
<p>Clone the <code>LUMI-SoftwareStack</code> repository in that directory. You can change
    the name of the repository directory to anything as the whole installation is independent
    of that name provided that <code>LMOD_PACKAGE_PATH</code> refers to the LMOD installation in that
    repository. In the documentation, we call the directory <code>SystemRepo</code> (as opposed
    to <code>UserRepo</code> for a user installation that depends on a master installation).</p>
</li>
<li>
<p>Run the <code>prepare_LUMI.sh</code> script from <code>SystemRepo/scripts</code> to initialise the
    directory structure. The script takes no arguments but it is important to run the
    version in the <code>SytemRepo</code> in the software installation that needs to be initialised.</p>
</li>
<li>
<p>Running the <code>enable_LUMI.sh</code> script from <code>SystemRepo/scripts</code> prints the (bash)
    shell commands that need to be executed to initialise the shell to start using this
    software installation. A very good way is to use it with <code>eval</code>:
    <div class="highlight"><pre><span></span><code><span class="nb">eval</span><span class="w"> </span><span class="k">$(</span>&lt;directory&gt;/SystemRepo/scripts/enable_LUMI.sh<span class="k">)</span>
</code></pre></div></p>
</li>
</ol>
<p>Now use the procedure "Installing a new version of the Cray PE on the system" to start
a new version of the LUMI software stack, skipping the creation of those files that
may already be in the repository because someone else has done them already.</p>
<h2 id="bumping-the-toolchain-to-a-newer-version-without-changing-the-other-dependencies">Bumping the toolchain to a newer version without changing the other dependencies<a class="headerlink" href="#bumping-the-toolchain-to-a-newer-version-without-changing-the-other-dependencies" title="Permanent link">&para;</a></h2>
<p>For now, we use the script <code>upgrade-tc.py</code> developed at CSCS and kept in the <code>tools</code>
subdirectory. It is also available when any of our EasyBuild configuration modules is loaded.</p>
<h2 id="bumping-the-toolchain-to-a-newer-version-and-changing-the-other-dependencies">Bumping the toolchain to a newer version and changing the other dependencies<a class="headerlink" href="#bumping-the-toolchain-to-a-newer-version-and-changing-the-other-dependencies" title="Permanent link">&para;</a></h2>
<p>Two scripts situated in the <code>tools</code> subdirectory and available in the path when any of the
EasyBuild configuration modules is loaded can help with this:</p>
<ul>
<li><code>upgrade-tc.py</code> is a script developed at CSCS to upgrade the toolchain in the EasyConfig
    file. It will also update the name of the EasyConfig file to reflect the new toolchain version.</li>
<li><code>upgrade-locals.txt</code> uses the set of <code>local_*_version</code> variable defintions in one of the
    <code>versions-yy.mm.txt</code> files to update those variables in one or more given EasyConfig file.</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCb31KOJ6Wqu0sRpIRi_k8Mw" target="_blank" rel="noopener" title="LUMI on YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/lumi-supercomputer" target="_blank" rel="noopener" title="LUMI on LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/LUMIhpc" target="_blank" rel="noopener" title="LUMI on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.top", "navigation.indexes", "header.autohide", "toc.follow"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b78d2936.min.js"></script>
      
    
  </body>
</html>